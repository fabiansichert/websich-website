DirectoryIndex index.php
RewriteEngine On


RewriteCond %{HTTP:X-Forwarded-Proto} !https
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

RewriteBase /
RewriteRule ^$ index.php [L]

# ==========================================================
# Alte URLs → neue Ziele
# ==========================================================
Redirect 301 /index.html /
Redirect 301 /html/angebot.html /
Redirect 301 /html/kontakt.html /
Redirect 301 /html/ueberuns.html /
Redirect 301 /html/impressum.html /impressum
Redirect 301 /html/datenschutz.html /datenschutz
Redirect 301 /html/agb.html /

# ==========================================================
# Pretty URLs für neue Seiten
# ==========================================================
RewriteRule ^datenschutz/?$ /src/pages/datenschutz.php [L]
RewriteRule ^cookies/?$ /src/pages/cookies.php [L]
RewriteRule ^impressum/?$ /src/pages/impressum.php [L]

# ==========================================================
# Error Routes
# ==========================================================
RewriteRule ^error/?$ /src/pages/error.php [L]

ErrorDocument 404 /src/pages/error.php
ErrorDocument 403 /src/pages/error.php
ErrorDocument 500 /src/pages/error.php

# ==========================================================
# Compression + Cache (DEIN REST IST OK)
# ==========================================================
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css \
    application/xml application/xhtml+xml application/rss+xml \
    application/javascript application/x-javascript image/svg+xml
</IfModule>

<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType image/x-icon "access plus 1 year"
  ExpiresByType font/ttf "access plus 1 year"
  ExpiresByType font/otf "access plus 1 year"
  ExpiresByType font/woff "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"
  ExpiresByType text/css "access plus 3 months"
  ExpiresByType application/javascript "access plus 3 months"
  ExpiresByType application/x-javascript "access plus 3 months"
  ExpiresByType application/json "access plus 7 days"
  ExpiresByType application/manifest+json "access plus 7 days"
  ExpiresByType text/html "access plus 0 seconds"
</IfModule>

<IfModule mod_headers.c>
  <FilesMatch "\.(js|css|png|jpg|jpeg|gif|svg|webp|woff|woff2|ttf|otf)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>
  <FilesMatch "\.(html|php)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
  </FilesMatch>
</IfModule>

<IfModule mod_headers.c>
Header set Content-Security-Policy "default-src 'self'; script-src 'self' https://www.google.com https://www.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data: https:; connect-src 'self'; frame-src https://www.google.com;"
</IfModule>
